# Segunda Visualiza√ß√£o - Sistema de Controle Lar dos Idosos

## üìä An√°lise Comparativa: Duas Abordagens

### Proposta A: **Aplica√ß√£o Desktop Local** (RECOMENDADA para uso em um computador)
### Proposta B: **PWA Completa** (Arquitetura original - mais complexa)

---

## üéØ PROPOSTA A: Aplica√ß√£o Desktop Simplificada (RECOMENDADA)

### **Por que esta abordagem?**
- ‚úÖ Uso em apenas um computador
- ‚úÖ Instala√ß√£o e manuten√ß√£o mais simples
- ‚úÖ N√£o precisa configurar servidor
- ‚úÖ Arquivo de banco de dados √∫nico e port√°til
- ‚úÖ Acesso direto √†s pastas de rede para salvar recibos
- ‚úÖ Performance superior (sem lat√™ncia de rede)

### **1. Stack Tecnol√≥gico**

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ     APLICA√á√ÉO DESKTOP INTEGRADA         ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  Frontend: React + TypeScript + Vite    ‚îÇ
‚îÇ  UI: Material-UI (MUI)                  ‚îÇ
‚îÇ  Estado: Zustand                        ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  Runtime: Electron                      ‚îÇ
‚îÇ  - Janela nativa do Windows             ‚îÇ
‚îÇ  - Integra√ß√£o com sistema de arquivos   ‚îÇ
‚îÇ  - Menu e atalhos                       ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  Backend Integrado: Node.js             ‚îÇ
‚îÇ  - API interna (IPC do Electron)        ‚îÇ
‚îÇ  - Gera√ß√£o de DOCX (biblioteca docx)    ‚îÇ
‚îÇ  - ORM: Prisma                          ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  Banco de Dados: SQLite                 ‚îÇ
‚îÇ  - Arquivo √∫nico: lar_idosos.db         ‚îÇ
‚îÇ  - Backup f√°cil (copiar arquivo)        ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### **2. Estrutura do Projeto**

```
PWALarIdosos/
‚îú‚îÄ‚îÄ electron/                    # Configura√ß√£o do Electron
‚îÇ   ‚îú‚îÄ‚îÄ main.ts                 # Processo principal
‚îÇ   ‚îú‚îÄ‚îÄ preload.ts              # Bridge seguro
‚îÇ   ‚îî‚îÄ‚îÄ ipc-handlers/           # Handlers da API interna
‚îÇ       ‚îú‚îÄ‚îÄ idosos.handler.ts
‚îÇ       ‚îú‚îÄ‚îÄ pagamentos.handler.ts
‚îÇ       ‚îî‚îÄ‚îÄ recibos.handler.ts
‚îÇ
‚îú‚îÄ‚îÄ src/                        # Frontend React
‚îÇ   ‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Dashboard/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ DashboardGrid.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ DashboardCell.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ PaymentModal.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Idosos/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ IdososList.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ IdosoForm.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Responsaveis/
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ResponsavelForm.tsx
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ Layout/
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ Sidebar.tsx
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ Header.tsx
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ pages/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ DashboardPage.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ IdososPage.tsx
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ConfiguracoesPage.tsx
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ stores/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ useIdososStore.ts
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ usePagamentosStore.ts
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ electron-api.ts    # Interface com IPC
‚îÇ   ‚îÇ
‚îÇ   ‚îî‚îÄ‚îÄ App.tsx
‚îÇ
‚îú‚îÄ‚îÄ prisma/
‚îÇ   ‚îú‚îÄ‚îÄ schema.prisma           # Modelo do banco SQLite
‚îÇ   ‚îî‚îÄ‚îÄ migrations/
‚îÇ
‚îú‚îÄ‚îÄ database/
‚îÇ   ‚îî‚îÄ‚îÄ lar_idosos.db          # Banco de dados SQLite (criado em runtime)
‚îÇ
‚îî‚îÄ‚îÄ package.json
```

### **3. Esquema do Banco de Dados SQLite**

```prisma
// prisma/schema.prisma

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = "file:./lar_idosos.db"
}

model Responsavel {
  id              Int      @id @default(autoincrement())
  nome            String
  cpf             String   @unique
  contatoTelefone String?
  contatoEmail    String?
  idosos          Idoso[]
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
}

model Idoso {
  id                    Int          @id @default(autoincrement())
  nome                  String
  cpf                   String?      @unique
  dataNascimento        DateTime?
  responsavelId         Int
  responsavel           Responsavel  @relation(fields: [responsavelId], references: [id])
  valorMensalidadeBase  Float
  pagamentos            Pagamento[]
  ativo                 Boolean      @default(true)
  createdAt             DateTime     @default(now())
  updatedAt             DateTime     @updatedAt
}

model Pagamento {
  id                      Int       @id @default(autoincrement())
  idosoId                 Int
  idoso                   Idoso     @relation(fields: [idosoId], references: [id])
  mesReferencia           Int       // 1-12
  anoReferencia           Int       // 2025, 2026...
  valorPago               Float     @default(0)
  dataPagamento           DateTime?
  nfse                    String?   // N√∫mero da Nota Fiscal
  status                  String    @default("PENDENTE") // PENDENTE, PARCIAL, PAGO
  valorDoacaoCalculado    Float     @default(0)
  caminhoReciboDoacao     String?   // Caminho do DOCX gerado
  observacoes             String?
  createdAt               DateTime  @default(now())
  updatedAt               DateTime  @updatedAt

  @@unique([idosoId, mesReferencia, anoReferencia])
}

model Configuracao {
  id                      Int       @id @default(autoincrement())
  chave                   String    @unique
  valor                   String
  descricao               String?
}

// Armazenar caminhos das pastas de rede em Configuracao:
// - caminho_recibos_doacao
// - caminho_recibos_mensalidade
// - template_recibo_doacao (caminho para template DOCX base, se houver)
```

### **4. API Interna (IPC do Electron)**

Em vez de endpoints HTTP, usamos IPC (Inter-Process Communication):

```typescript
// electron/ipc-handlers/idosos.handler.ts

import { ipcMain } from 'electron';
import { PrismaClient } from '@prisma/client';

const prisma = new PrismaClient();

export function setupIdososHandlers() {
  // Listar todos os idosos
  ipcMain.handle('idosos:list', async () => {
    return await prisma.idoso.findMany({
      include: {
        responsavel: true,
      },
      where: { ativo: true },
      orderBy: { nome: 'asc' },
    });
  });

  // Criar idoso
  ipcMain.handle('idosos:create', async (event, data) => {
    return await prisma.idoso.create({
      data: {
        nome: data.nome,
        cpf: data.cpf,
        dataNascimento: data.dataNascimento,
        responsavelId: data.responsavelId,
        valorMensalidadeBase: data.valorMensalidadeBase,
      },
    });
  });

  // Atualizar idoso
  ipcMain.handle('idosos:update', async (event, id, data) => {
    return await prisma.idoso.update({
      where: { id },
      data,
    });
  });

  // Desativar idoso (soft delete)
  ipcMain.handle('idosos:delete', async (event, id) => {
    return await prisma.idoso.update({
      where: { id },
      data: { ativo: false },
    });
  });
}
```

```typescript
// electron/ipc-handlers/pagamentos.handler.ts

import { ipcMain } from 'electron';
import { PrismaClient } from '@prisma/client';

const prisma = new PrismaClient();

export function setupPagamentosHandlers() {
  // Buscar dados para o dashboard
  ipcMain.handle('dashboard:get', async (event, ano: number) => {
    const idosos = await prisma.idoso.findMany({
      where: { ativo: true },
      include: { responsavel: true },
      orderBy: { nome: 'asc' },
    });

    const pagamentos = await prisma.pagamento.findMany({
      where: { anoReferencia: ano },
    });

    // Formatar dados para o grid
    const pagamentosMap: Record<number, Record<number, any>> = {};
    
    pagamentos.forEach(p => {
      if (!pagamentosMap[p.idosoId]) {
        pagamentosMap[p.idosoId] = {};
      }
      pagamentosMap[p.idosoId][p.mesReferencia] = {
        id: p.id,
        status: p.status,
        nfse: p.nfse,
        valorPago: p.valorPago,
        dataPagamento: p.dataPagamento,
      };
    });

    return {
      idosos,
      pagamentos: pagamentosMap,
    };
  });

  // Lan√ßar/atualizar pagamento
  ipcMain.handle('pagamento:upsert', async (event, data) => {
    const idoso = await prisma.idoso.findUnique({
      where: { id: data.idosoId },
    });

    if (!idoso) throw new Error('Idoso n√£o encontrado');

    // Calcular status
    let status = 'PENDENTE';
    const valorPago = parseFloat(data.valorPago) || 0;
    const valorBase = idoso.valorMensalidadeBase;

    if (valorPago >= valorBase) {
      status = 'PAGO';
    } else if (valorPago > 0) {
      status = 'PARCIAL';
    }

    // Calcular doa√ß√£o (se houver excedente)
    const valorDoacaoCalculado = Math.max(0, valorPago - valorBase);

    return await prisma.pagamento.upsert({
      where: {
        idosoId_mesReferencia_anoReferencia: {
          idosoId: data.idosoId,
          mesReferencia: data.mesReferencia,
          anoReferencia: data.anoReferencia,
        },
      },
      update: {
        valorPago,
        dataPagamento: data.dataPagamento,
        nfse: data.nfse,
        status,
        valorDoacaoCalculado,
        observacoes: data.observacoes,
      },
      create: {
        idosoId: data.idosoId,
        mesReferencia: data.mesReferencia,
        anoReferencia: data.anoReferencia,
        valorPago,
        dataPagamento: data.dataPagamento,
        nfse: data.nfse,
        status,
        valorDoacaoCalculado,
        observacoes: data.observacoes,
      },
    });
  });
}
```

```typescript
// electron/ipc-handlers/recibos.handler.ts

import { ipcMain, dialog } from 'electron';
import { PrismaClient } from '@prisma/client';
import { Document, Packer, Paragraph, TextRun, HeadingLevel, AlignmentType } from 'docx';
import * as fs from 'fs';
import * as path from 'path';

const prisma = new PrismaClient();

export function setupRecibosHandlers() {
  // Gerar recibo de doa√ß√£o
  ipcMain.handle('recibo:gerar-doacao', async (event, pagamentoId: number) => {
    const pagamento = await prisma.pagamento.findUnique({
      where: { id: pagamentoId },
      include: {
        idoso: {
          include: {
            responsavel: true,
          },
        },
      },
    });

    if (!pagamento || pagamento.valorDoacaoCalculado <= 0) {
      throw new Error('Recibo de doa√ß√£o n√£o aplic√°vel');
    }

    // Buscar caminho configurado para salvar recibos
    const configCaminho = await prisma.configuracao.findUnique({
      where: { chave: 'caminho_recibos_doacao' },
    });

    const caminhoBase = configCaminho?.valor || 'C:\\Nestjs\\PWALarIdosos\\RECIBOS DOA√á√ÉO LAR';

    // Criar documento DOCX
    const meses = [
      'Janeiro', 'Fevereiro', 'Mar√ßo', 'Abril', 'Maio', 'Junho',
      'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'
    ];

    const doc = new Document({
      sections: [{
        properties: {},
        children: [
          new Paragraph({
            text: "RECIBO DE DOA√á√ÉO",
            heading: HeadingLevel.TITLE,
            alignment: AlignmentType.CENTER,
            spacing: { after: 400 },
          }),
          new Paragraph({
            text: `N¬∫ ${pagamento.nfse || '___________'}`,
            alignment: AlignmentType.RIGHT,
            spacing: { after: 600 },
          }),
          new Paragraph({
            children: [
              new TextRun("Recebemos de "),
              new TextRun({ 
                text: pagamento.idoso.responsavel.nome.toUpperCase(), 
                bold: true 
              }),
              new TextRun(", CPF n¬∫ "),
              new TextRun({ 
                text: pagamento.idoso.responsavel.cpf, 
                bold: true 
              }),
              new TextRun(", a quantia de "),
              new TextRun({ 
                text: `R$ ${pagamento.valorDoacaoCalculado.toFixed(2).replace('.', ',')}`, 
                bold: true,
                underline: {}
              }),
              new TextRun(" ("),
              new TextRun({ 
                text: numeroParaExtenso(pagamento.valorDoacaoCalculado),
                italics: true
              }),
              new TextRun("), referente √† "),
              new TextRun({ 
                text: "doa√ß√£o volunt√°ria", 
                bold: true 
              }),
              new TextRun(" para aux√≠lio de "),
              new TextRun({ 
                text: pagamento.idoso.nome.toUpperCase(), 
                bold: true 
              }),
              new TextRun(", na compet√™ncia de "),
              new TextRun({ 
                text: `${meses[pagamento.mesReferencia - 1]}/${pagamento.anoReferencia}`,
                bold: true
              }),
              new TextRun("."),
            ],
            spacing: { after: 800 },
          }),
          new Paragraph({
            text: " ",
            spacing: { after: 400 },
          }),
          new Paragraph({
            text: `Matel√¢ndia, ${formatarDataExtenso(new Date())}.`,
            alignment: AlignmentType.RIGHT,
            spacing: { after: 1200 },
          }),
          new Paragraph({
            text: " ",
            spacing: { after: 800 },
          }),
          new Paragraph({
            text: "________________________________________",
            alignment: AlignmentType.CENTER,
          }),
          new Paragraph({
            text: "Associa√ß√£o Filhas de S√£o Camilo",
            alignment: AlignmentType.CENTER,
            bold: true,
          }),
          new Paragraph({
            text: "CNPJ: XX.XXX.XXX/XXXX-XX",
            alignment: AlignmentType.CENTER,
            spacing: { after: 400 },
          }),
        ],
      }],
    });

    // Gerar buffer
    const buffer = await Packer.toBuffer(doc);

    // Nome do arquivo
    const nomeArquivo = `${pagamento.nfse || pagamento.id}_${pagamento.idoso.nome.replace(/\s+/g, '_').toUpperCase()}.docx`;
    const caminhoCompleto = path.join(caminhoBase, nomeArquivo);

    // Salvar arquivo
    fs.writeFileSync(caminhoCompleto, buffer);

    // Atualizar registro no banco
    await prisma.pagamento.update({
      where: { id: pagamentoId },
      data: { caminhoReciboDoacao: caminhoCompleto },
    });

    return {
      sucesso: true,
      caminho: caminhoCompleto,
      nomeArquivo,
    };
  });

  // Abrir pasta de recibos
  ipcMain.handle('recibo:abrir-pasta', async (event, tipo: 'doacao' | 'mensalidade') => {
    const chave = tipo === 'doacao' ? 'caminho_recibos_doacao' : 'caminho_recibos_mensalidade';
    const config = await prisma.configuracao.findUnique({
      where: { chave },
    });

    if (config?.valor) {
      const { shell } = require('electron');
      shell.openPath(config.valor);
    }
  });
}

// Fun√ß√µes auxiliares
function formatarDataExtenso(data: Date): string {
  const dia = data.getDate();
  const meses = [
    'janeiro', 'fevereiro', 'mar√ßo', 'abril', 'maio', 'junho',
    'julho', 'agosto', 'setembro', 'outubro', 'novembro', 'dezembro'
  ];
  const mes = meses[data.getMonth()];
  const ano = data.getFullYear();
  
  return `${dia} de ${mes} de ${ano}`;
}

function numeroParaExtenso(valor: number): string {
  // Implementa√ß√£o simplificada - pode usar biblioteca como 'extenso'
  // ou implementar l√≥gica completa
  return `${valor.toFixed(2)} reais`;
}
```

### **5. Frontend - Componentes Principais**

```tsx
// src/components/Dashboard/DashboardCell.tsx

import React from 'react';
import { Box, Tooltip } from '@mui/material';

interface DashboardCellProps {
  status: 'PAGO' | 'PARCIAL' | 'PENDENTE';
  nfse?: string;
  onClick: () => void;
}

const DashboardCell: React.FC<DashboardCellProps> = ({ status, nfse, onClick }) => {
  const cores = {
    PAGO: '#4caf50',      // Verde vibrante
    PARCIAL: '#ff9800',    // Laranja
    PENDENTE: '#f44336',   // Vermelho
  };

  const labels = {
    PAGO: 'Pago',
    PARCIAL: 'Parcial',
    PENDENTE: 'Pendente',
  };

  return (
    <Tooltip title={labels[status]}>
      <Box
        onClick={onClick}
        sx={{
          backgroundColor: cores[status],
          minHeight: '60px',
          display: 'flex',
          alignItems: 'center',
          justifyContent: 'center',
          cursor: 'pointer',
          border: '2px solid white',
          transition: 'all 0.2s',
          color: 'white',
          fontWeight: 'bold',
          fontSize: '0.9rem',
          '&:hover': {
            transform: 'scale(1.05)',
            boxShadow: 3,
          },
        }}
      >
        {nfse || '-'}
      </Box>
    </Tooltip>
  );
};

export default DashboardCell;
```

```tsx
// src/components/Dashboard/DashboardGrid.tsx

import React from 'react';
import { 
  Table, 
  TableBody, 
  TableCell, 
  TableContainer, 
  TableHead, 
  TableRow, 
  Paper 
} from '@mui/material';
import DashboardCell from './DashboardCell';

interface DashboardGridProps {
  idosos: any[];
  pagamentos: Record<number, Record<number, any>>;
  onCellClick: (idosoId: number, mes: number) => void;
}

const DashboardGrid: React.FC<DashboardGridProps> = ({ 
  idosos, 
  pagamentos, 
  onCellClick 
}) => {
  const meses = ['Jan', 'Fev', 'Mar', 'Abr', 'Mai', 'Jun', 
                 'Jul', 'Ago', 'Set', 'Out', 'Nov', 'Dez'];

  return (
    <TableContainer component={Paper} sx={{ maxHeight: 'calc(100vh - 200px)' }}>
      <Table stickyHeader>
        <TableHead>
          <TableRow>
            <TableCell 
              sx={{ 
                fontWeight: 'bold', 
                backgroundColor: '#1976d2', 
                color: 'white',
                minWidth: '200px',
              }}
            >
              Idoso
            </TableCell>
            {meses.map((mes, idx) => (
              <TableCell 
                key={idx} 
                align="center"
                sx={{ 
                  fontWeight: 'bold', 
                  backgroundColor: '#1976d2', 
                  color: 'white',
                  minWidth: '80px',
                }}
              >
                {mes}
              </TableCell>
            ))}
          </TableRow>
        </TableHead>
        <TableBody>
          {idosos.map(idoso => (
            <TableRow key={idoso.id}>
              <TableCell sx={{ fontWeight: 'medium' }}>
                {idoso.nome}
              </TableCell>
              {[1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12].map(mes => {
                const pag = pagamentos[idoso.id]?.[mes];
                const status = pag?.status || 'PENDENTE';
                
                return (
                  <TableCell key={mes} sx={{ padding: 0 }}>
                    <DashboardCell
                      status={status}
                      nfse={pag?.nfse}
                      onClick={() => onCellClick(idoso.id, mes)}
                    />
                  </TableCell>
                );
              })}
            </TableRow>
          ))}
        </TableBody>
      </Table>
    </TableContainer>
  );
};

export default DashboardGrid;
```

### **6. Configura√ß√£o Inicial e Seeds**

```typescript
// prisma/seeds/inicial.ts

import { PrismaClient } from '@prisma/client';

const prisma = new PrismaClient();

async function seed() {
  // Configura√ß√µes padr√£o
  await prisma.configuracao.createMany({
    data: [
      {
        chave: 'caminho_recibos_doacao',
        valor: 'C:\\Nestjs\\PWALarIdosos\\RECIBOS DOA√á√ÉO LAR',
        descricao: 'Pasta de rede para salvar recibos de doa√ß√£o',
      },
      {
        chave: 'caminho_recibos_mensalidade',
        valor: 'C:\\Nestjs\\PWALarIdosos\\RECIBOS',
        descricao: 'Pasta de rede para salvar recibos de mensalidade',
      },
      {
        chave: 'cnpj_instituicao',
        valor: 'XX.XXX.XXX/XXXX-XX',
        descricao: 'CNPJ da institui√ß√£o',
      },
      {
        chave: 'nome_instituicao',
        valor: 'Associa√ß√£o Filhas de S√£o Camilo',
        descricao: 'Nome da institui√ß√£o',
      },
    ],
    skipDuplicates: true,
  });

  console.log('‚úÖ Configura√ß√µes iniciais criadas');
}

seed()
  .catch(e => {
    console.error(e);
    process.exit(1);
  })
  .finally(async () => {
    await prisma.$disconnect();
  });
```

---

## üåê PROPOSTA B: PWA Completa (Arquitetura Original)

### **Por que esta abordagem?**
- ‚úÖ Acesso de m√∫ltiplos dispositivos/computadores
- ‚úÖ Acesso remoto via navegador
- ‚úÖ Mais escal√°vel para o futuro
- ‚ö†Ô∏è Mais complexa de configurar e manter
- ‚ö†Ô∏è Requer servidor sempre rodando

### **Stack (conforme primeira visualiza√ß√£o)**

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ          FRONTEND (PWA)                   ‚îÇ
‚îÇ  React + TypeScript + Material-UI        ‚îÇ
‚îÇ  Service Worker + manifest.json          ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                    ‚Üì HTTP/REST
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ          BACKEND (API)                    ‚îÇ
‚îÇ  Node.js + Express + TypeScript          ‚îÇ
‚îÇ  Rotas RESTful                           ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                    ‚Üì SQL
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ      BANCO DE DADOS                       ‚îÇ
‚îÇ  PostgreSQL                               ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

*(Manter estrutura da primeira visualiza√ß√£o, com os ajustes necess√°rios)*

---

## üìã Plano de Implementa√ß√£o

### **Fase 1: Configura√ß√£o Inicial** (1-2 dias)
- [ ] Criar projeto Electron + React + TypeScript + Vite
- [ ] Configurar Prisma com SQLite
- [ ] Criar estrutura de pastas
- [ ] Configurar Material-UI e tema personalizado

### **Fase 2: Backend e Banco de Dados** (2-3 dias)
- [ ] Implementar schema Prisma completo
- [ ] Criar migrations
- [ ] Implementar IPC handlers (idosos, respons√°veis, pagamentos)
- [ ] Implementar gerador de recibos DOCX
- [ ] Criar seed com dados de configura√ß√£o

### **Fase 3: Frontend - Dashboard** (3-4 dias)
- [ ] Criar layout base (Sidebar, Header)
- [ ] Implementar DashboardGrid com cores
- [ ] Implementar DashboardCell (verde/vermelho/laranja)
- [ ] Modal de pagamento (formul√°rio)
- [ ] Integra√ß√£o com IPC API

### **Fase 4: Frontend - Cadastros** (2-3 dias)
- [ ] P√°gina de cadastro de respons√°veis
- [ ] P√°gina de cadastro de idosos
- [ ] Formul√°rios com valida√ß√£o
- [ ] Listagens com busca e filtros

### **Fase 5: Gera√ß√£o de Recibos** (2-3 dias)
- [ ] Template de recibo de doa√ß√£o
- [ ] Template de recibo de mensalidade (se necess√°rio)
- [ ] Bot√£o para gerar recibo no modal
- [ ] Salvar automaticamente na pasta de rede configurada
- [ ] Bot√£o para abrir pasta de recibos

### **Fase 6: Configura√ß√µes e Ajustes** (1-2 dias)
- [ ] P√°gina de configura√ß√µes (caminhos de pastas)
- [ ] Valida√ß√µes e tratamento de erros
- [ ] Mensagens de feedback (toasts/snackbars)
- [ ] Atalhos de teclado

### **Fase 7: Testes e Refinamentos** (2-3 dias)
- [ ] Testes de funcionalidades
- [ ] Ajustes visuais
- [ ] Performance
- [ ] Cria√ß√£o de instalador (.exe)

### **Fase 8: Migra√ß√£o de Dados** (1-2 dias)
- [ ] Script para importar dados dos DOCX existentes (se necess√°rio)
- [ ] Valida√ß√£o dos dados importados

---

## üé® Paleta de Cores Vibrantes

```
Status de Pagamento:
‚îú‚îÄ‚îÄ PAGO:     #4caf50  (Verde vibrante)
‚îú‚îÄ‚îÄ PARCIAL:  #ff9800  (Laranja chamativo)
‚îî‚îÄ‚îÄ PENDENTE: #f44336  (Vermelho alerta)

UI Principal:
‚îú‚îÄ‚îÄ Primary:   #1976d2  (Azul Material)
‚îú‚îÄ‚îÄ Secondary: #dc004e  (Rosa destaque)
‚îú‚îÄ‚îÄ Success:   #4caf50  (Verde)
‚îú‚îÄ‚îÄ Warning:   #ff9800  (Laranja)
‚îú‚îÄ‚îÄ Error:     #f44336  (Vermelho)
‚îî‚îÄ‚îÄ Info:      #2196f3  (Azul claro)
```

---

## üì¶ Depend√™ncias Principais

```json
{
  "dependencies": {
    "react": "^18.2.0",
    "react-dom": "^18.2.0",
    "@mui/material": "^5.14.0",
    "@mui/icons-material": "^5.14.0",
    "@emotion/react": "^11.11.0",
    "@emotion/styled": "^11.11.0",
    "zustand": "^4.4.0",
    "docx": "^8.5.0",
    "@prisma/client": "^5.5.0"
  },
  "devDependencies": {
    "electron": "^27.0.0",
    "electron-builder": "^24.6.0",
    "vite": "^5.0.0",
    "@vitejs/plugin-react": "^4.2.0",
    "typescript": "^5.2.0",
    "prisma": "^5.5.0"
  }
}
```

---

## üöÄ Como Executar (Desenvolvimento)

```bash
# Instalar depend√™ncias
npm install

# Iniciar Prisma (criar DB e migrations)
npx prisma migrate dev --name init

# Rodar seed (configura√ß√µes iniciais)
npx prisma db seed

# Iniciar aplica√ß√£o
npm run dev

# Build para produ√ß√£o
npm run build

# Criar instalador
npm run dist
```

---

## üíæ Backup e Seguran√ßa

### Backup do Banco de Dados
```
O arquivo lar_idosos.db pode ser copiado periodicamente para:
- Pasta de rede
- OneDrive/Google Drive
- Pen drive
```

### Backup dos Recibos
```
Os recibos s√£o salvos diretamente nas pastas de rede configuradas:
- C:\Nestjs\PWALarIdosos\RECIBOS DOA√á√ÉO LAR
- C:\Nestjs\PWALarIdosos\RECIBOS\[M√äS.ANO]
```

---

## ‚úÖ Checklist de Funcionalidades

- [x] Dashboard visual com grid de meses
- [x] Cores vibrantes (verde/vermelho/laranja)
- [x] Status: PAGO, PARCIAL, PENDENTE
- [x] Cadastro de idosos e respons√°veis
- [x] Lan√ßamento de pagamentos
- [x] Gera√ß√£o autom√°tica de recibos DOCX
- [x] Salvamento em pastas de rede
- [x] C√°lculo autom√°tico de doa√ß√£o
- [x] N√∫mero de nota fiscal em cada c√©lula
- [x] Interface harmoniosa e moderna

---

## üéØ Recomenda√ß√£o Final

**Para uso em um √∫nico computador: PROPOSTA A (Desktop)**
- Mais simples de configurar
- Mais r√°pida
- Mais f√°cil de dar backup
- Instala√ß√£o com um √∫nico arquivo .exe

**Para uso futuro em m√∫ltiplos computadores: PROPOSTA B (PWA)**
- Mais trabalho inicial
- Acesso via navegador
- Melhor para crescimento futuro

---

## üìù Pr√≥ximos Passos

1. **Decidir qual proposta implementar** (A ou B)
2. **Iniciar Fase 1** - Configura√ß√£o do projeto
3. **Validar estrutura** com voc√™ antes de avan√ßar
4. **Implementar incrementalmente** testando cada fase

---

*Documento gerado em: 10/10/2025*
*Vers√£o: 2.0*




